(()=>{"use strict";class e{currentScene=null;constructor(){return e.instance||(e.instance=this),e.instance}async cargarPantalla(e){this.currentScene&&this.currentScene?.onDestroy();const t=document.getElementById("pantalla"),o=await fetch(`./templates/${e.template}`).then((e=>e.text()));t.innerHTML=o,e.loadLogic(),this.currentScene=e}}class t{hoveraudio;hitaudio;datoUsuario;datoJuego;intervalid;constructor(){this.hoveraudio=new Audio("/build/assets/audio/pop.mp3"),this.hitaudio=new Audio("/build/assets/audio/hit.mp3"),this.datoUsuario=JSON.parse(localStorage.getItem("usuario-progreso")),this.datoJuego={estrellas:0,vida:3,tiempo:0}}setearModal=()=>{const t=document.querySelector(".continuar");this.setearBoton(t,(()=>{(new e).cargarPantalla(o)}))};cerrarJuego=(e=0)=>{setTimeout((()=>{const e=document.querySelector(".modal"),t=document.querySelector(".preparado");document.querySelector(".resultado").classList.add("hide"),t.classList.add("hide"),e.classList.add("hide")}),1e3*e)};inicarJuego=(e,t,o=function(){})=>{const a=document.querySelector(e)||document.getElementById(e);this.datoJuego.tiempo=t;let s=t,r=1;this.intervalid=setInterval((()=>{a.innerHTML=s+":"+r,this.datoJuego.vida<=0&&this.nivelFallido(),o(),0==r&&(0==s&&0==r&&this.nivelFallido(),s--,this.datoJuego.tiempo=s,r=60),r--}),1e3*t)};setearBoton=(e,t=function(){})=>{let o;o=e.className?e:document.querySelector(e)||document.getElementById(e),o.addEventListener("mouseover",(e=>{this.hoveraudio.load(),this.hoveraudio.play()})),o.addEventListener("click",(e=>{this.hitaudio.currentTime=.2,this.hitaudio.play(),t()}))};restarVida=(e,t)=>{const o=document.querySelector(e)||document.getElementById(e),a=document.querySelector(t)||document.getElementById(t);this.datoJuego.vida--,a.classList.add("malo"),o.innerHTML=o.innerHTML.slice(0,-2),setTimeout((()=>{a.classList.remove("malo")}),500)};nivelFallido=()=>{const e=document.querySelector(".modal"),t=document.querySelector(".resultado"),o=document.querySelector(".resultado-txt");e.classList.remove("hide"),t.classList.remove("hide"),o.classList.add("fallido"),o.innerHTML="Nivel Fallido",clearInterval(this.intervalid)};personajeHablar=(e,t,o=0)=>{setTimeout((()=>{const o=document.querySelector(e)||document.getElementById(e),a=new Audio("/build/assets/audio/hablar.mp3"),s=document.querySelector(".texto");a.load(),a.currentTime=0,s.innerHTML=t,s.classList.add("hablar"),o.classList.add("hablar-pj"),a.play(),setTimeout((()=>{a.pause(),o.classList.remove("hablar-pj"),s.classList.remove("hablar")}),4e3)}),1e3*o)};calcularEstrellas=()=>{3==this.datoJuego.vida&&this.datoJuego.tiempo<=3&&(this.datoJuego.estrellas=3),this.datoJuego.vida<=2&&this.datoJuego.tiempo>=2&&(this.datoJuego.estrellas=2),this.datoJuego.vida<=1&&this.datoJuego.tiempo>=2&&(this.datoJuego.estrellas=2),1==this.datoJuego.vida&&this.datoJuego.tiempo>=1&&(this.datoJuego.estrellas=1),1==this.datoJuego.vida&&this.datoJuego.tiempo>=0&&(this.datoJuego.estrellas=1)};terminarJuego=()=>{const e=document.querySelector(".modal"),t=document.querySelector(".resultado"),o=document.querySelector(".resultado-txt"),a=document.querySelector(".estrellas-resultado");1==this.datoJuego.estrellas&&(a.innerHTML="⭐"),2==this.datoJuego.estrellas&&(a.innerHTML="⭐⭐"),3==this.datoJuego.estrellas&&(a.innerHTML="⭐⭐⭐"),e.classList.remove("hide"),t.classList.remove("hide"),o.classList.remove("fallido"),o.innerHTML="Nivel Completado",clearInterval(this.intervalid)};guardarResultado=e=>{this.datoUsuario.progreso[e]||this.datoUsuario.progreso.push({nivel:e+1,estrellas:0}),this.datoUsuario.progreso[0].estrellas<this.datoJuego.estrellas&&(this.datoUsuario.progreso[0].estrellas=this.datoJuego.estrellas),localStorage.setItem("usuario-progreso",JSON.stringify(this.datoUsuario))};setearOpciones=(e,t,o=function(){},a=function(){})=>{const s=document.querySelectorAll(e);Array.from(s).map(((e,a)=>{a!=t&&(console.dir(e),this.setearBoton(e,o))})),s[t].addEventListener("click",(e=>{a()}))};SFXRespuestaBuena=()=>{const e=new Audio("/build/assets/audio/correcto.mp3");this.hitaudio.pause(),e.play()};SFXRespuestaMala=()=>{const e=new Audio("/build/assets/audio/incorrecto.mp3");this.hitaudio.pause(),e.play()}}const o={template:"mapa-niveles.html",posNivelesMapa:{"nivel-1":{top:"260px",left:"50px"},"nivel-2":{top:"465px",left:"185px"},"nivel-3":{top:"250px",left:"250px"},"nivel-4":{top:"150px",left:"300px"},"nivel-5":{top:"350px",left:"350px"}},juegosPorNiveles:{"nivel-1":{template:"juego1.html",loadLogic:function(){const e=new t;e.setearModal(),e.cerrarJuego(3),e.personajeHablar(".personaje","Hola, soy el personaje de este juego"),e.personajeHablar(".personaje","Necesito ayuda encontrando cuantas variables hay en <br> este problema si no los encuentro mi profesora <br>me va a matar!! ayudame porfavor!!",5),e.setearOpciones(".opc",0,(()=>{e.SFXRespuestaMala(),e.personajeHablar(".personaje","No, no es correcto, sigue intentando",0),e.restarVida(".vida-jugador",".vida")}),(()=>{e.SFXRespuestaBuena(),e.calcularEstrellas(),e.terminarJuego(),e.guardarResultado(1)})),e.inicarJuego(".tiempo-juego",3,(()=>{}))},onDestroy:function(){(new t).cerrarJuego()}},"nivel-2":{template:"juego2.html",loadLogic:function(){const a=new t;a.setearBoton(".xd",(()=>{console.log("xd"),a.guardarResultado(2),(new e).cargarPantalla(o),a.SFXRespuestaMala()}))},onDestroy:function(){}},"nivel-3":{template:"juego3.html",loadLogic:function(){},onDestroy:function(){}},"nivel-4":{template:"juego4.html",loadLogic:function(){},onDestroy:function(){}},"nivel-5":{template:"juego5.html",loadLogic:function(){},onDestroy:function(){}}},loadLogic:function(){const o=new t,a=JSON.parse(localStorage.getItem("usuario-progreso"));console.log(localStorage.getItem("usuario-progreso"));const s=document.getElementsByClassName("sprite");Array.from(s).map(((t,s)=>{if(console.log(s),a.progreso[s]){t.style.top=this.posNivelesMapa[t.dataset.nivel].top,t.style.left=this.posNivelesMapa[t.dataset.nivel].left,t.firstElementChild.innerText="Nivel "+t.dataset.nivel.split("-")[1],t.classList.remove("hide");const r=a.progreso[s].estrellas;1==r&&(t.lastElementChild.innerText="⭐"),2==r&&(t.lastElementChild.innerText="⭐⭐"),3==r&&(t.lastElementChild.innerText="⭐⭐⭐"),o.setearBoton(t,(()=>{(new e).cargarPantalla(this.juegosPorNiveles[t.dataset.nivel])}))}})),(()=>{const e=document.querySelector(".pj-nombre"),t=document.querySelector(".pj-estrellas");e.innerHTML=a.nombre||"Jugador",t.innerHTML=(()=>{let e=0;return a.progreso.forEach((t=>{e+=t.estrellas})),e})()})()},onDestroy:function(){}},a={template:"main-menu.html",loadLogic:function(){const a=new t;localStorage.getItem("usuario-progreso")||localStorage.setItem("usuario-progreso",JSON.stringify({nombre:"PRUEBA1",progreso:[{nivel:1,estrellas:0}],pw_vida:1,pw_congelar:1})),a.setearBoton("#play",(()=>{(new e).cargarPantalla(o)}))},onDestroy:function(){}};(new e).cargarPantalla(a)})();