(()=>{"use strict";class e{currentScene=null;constructor(){return e.instance||(e.instance=this),e.instance}async cargarPantalla(e){this.currentScene&&this.currentScene?.onDestroy();const a=document.getElementById("pantalla"),o=await fetch(`./templates/${e.template}`).then((e=>e.text()));a.innerHTML=o,e.loadLogic(),this.currentScene=e}}class a{hoveraudio;hitaudio;datoUsuario;datoJuego;intervalid;congelacion;constructor(){this.hoveraudio=new Audio("/build/assets/audio/pop.mp3"),this.hitaudio=new Audio("/build/assets/audio/hit.mp3"),this.datoUsuario=JSON.parse(localStorage.getItem("usuario-progreso")),this.datoJuego={estrellas:0,vida:3,tiempo:0},this.congelacion=!1}setearModal=()=>{const a=document.querySelector(".continuar");this.setearBoton(a,(()=>{(new e).cargarPantalla(o)}))};cerrarJuego=(e=0)=>{setTimeout((()=>{const e=document.querySelector(".modal"),a=document.querySelector(".preparado");document.querySelector(".resultado").classList.add("hide"),a.classList.add("hide"),e.classList.add("hide")}),1e3*e)};inicarJuego=(e,a,o=function(){})=>{const t=document.querySelector(e)||document.getElementById(e);this.datoJuego.tiempo=a;let r=a,s=1;this.intervalid=setInterval((()=>{this.datoJuego.vida<=0&&this.nivelFallido(),this.congelacion||(t.innerHTML=r+":"+s,o(),0==s&&(0==r&&0==s&&this.nivelFallido(),r--,this.datoJuego.tiempo=r,s=60),s--)}),1e3*a)};setearBoton=(e,a=function(){})=>{let o;o=e.className?e:document.querySelector(e)||document.getElementById(e),o.addEventListener("mouseover",(e=>{this.hoveraudio.load(),this.hoveraudio.play()})),o.addEventListener("click",(e=>{this.hitaudio.currentTime=.2,this.hitaudio.play(),a()}))};restarVida=(e,a)=>{const o=document.querySelector(e)||document.getElementById(e),t=document.querySelector(a)||document.getElementById(a);this.datoJuego.vida--,t.classList.add("malo"),o.innerHTML=o.innerHTML.slice(0,-2),setTimeout((()=>{t.classList.remove("malo")}),500)};nivelFallido=()=>{const e=document.querySelector(".modal"),a=document.querySelector(".resultado"),o=document.querySelector(".resultado-txt");e.classList.remove("hide"),a.classList.remove("hide"),o.classList.add("fallido"),o.innerHTML="Nivel Fallido",localStorage.setItem("usuario-progreso",JSON.stringify(this.datoUsuario)),clearInterval(this.intervalid)};personajeHablar=(e,a,o=0)=>{setTimeout((()=>{const o=document.querySelector(e)||document.getElementById(e),t=new Audio("/build/assets/audio/hablar.mp3"),r=document.querySelector(".texto");t.load(),t.currentTime=0,r.innerHTML=a,r.classList.add("hablar"),o.classList.add("hablar-pj"),t.play(),setTimeout((()=>{t.pause(),o.classList.remove("hablar-pj"),r.classList.remove("hablar")}),4e3)}),1e3*o)};calcularEstrellas=()=>{3==this.datoJuego.vida&&this.datoJuego.tiempo<=3&&(this.datoJuego.estrellas=3),this.datoJuego.vida<=2&&this.datoJuego.tiempo>=2&&(this.datoJuego.estrellas=2),this.datoJuego.vida<=1&&this.datoJuego.tiempo>=2&&(this.datoJuego.estrellas=2),this.datoJuego.vida<=2&&this.datoJuego.tiempo>=1&&(this.datoJuego.estrellas=2),this.datoJuego.vida<=1&&this.datoJuego.tiempo>=1&&(this.datoJuego.estrellas=1),1==this.datoJuego.vida&&this.datoJuego.tiempo>=0&&(this.datoJuego.estrellas=1)};terminarJuego=()=>{const e=document.querySelector(".modal"),a=document.querySelector(".resultado"),o=document.querySelector(".resultado-txt"),t=document.querySelector(".estrellas-resultado");1==this.datoJuego.estrellas&&(t.innerHTML="⭐"),2==this.datoJuego.estrellas&&(t.innerHTML="⭐⭐"),3==this.datoJuego.estrellas&&(t.innerHTML="⭐⭐⭐"),e.classList.remove("hide"),a.classList.remove("hide"),o.classList.remove("fallido"),o.innerHTML="Nivel Completado",clearInterval(this.intervalid)};guardarResultado=e=>{this.datoUsuario.progreso[e]||this.datoUsuario.progreso.push({nivel:e+1,estrellas:0}),this.datoUsuario.progreso[0+e-1].estrellas<this.datoJuego.estrellas&&(this.datoUsuario.progreso[0+e-1].estrellas=this.datoJuego.estrellas),localStorage.setItem("usuario-progreso",JSON.stringify(this.datoUsuario))};setearOpciones=(e,a,o=function(){},t=function(){})=>{const r=document.querySelectorAll(e);Array.from(r).map(((e,r)=>{r!=a&&this.setearBoton(e,o),r==a&&this.setearBoton(e,t)}))};setearPW=(e,a)=>{const o=document.querySelector(e)||document.getElementById(e),t=document.querySelector(a)||document.getElementById(a);o.innerHTML=this.datoUsuario.pw_vida,t.innerHTML=this.datoUsuario.pw_congelar};pwVidaExtra=(e,a,o)=>{if(this.datoJuego.vida<3&&0==!this.datoUsuario.pw_vida){const t=new Audio("/build/assets/audio/vidaExtra.mp3"),r=document.querySelector(e)||document.getElementById(e),s=document.querySelector(a)||document.getElementById(a),n=document.querySelector(o)||document.getElementById(o);t.currentTime=.25,t.play(),this.datoJuego.vida++,this.datoUsuario.pw_vida--,s.innerHTML--,r.classList.add("bueno"),n.innerHTML+="❤️",setTimeout((()=>{r.classList.remove("bueno")}),500)}};pwCongelacion=(e,a)=>{const o=new Audio("/build/assets/audio/congelacion.mp3"),t=document.querySelector(a)||document.getElementById(a),r=document.querySelector(e)||document.getElementById(e);0==!this.datoUsuario.pw_congelar&&0==this.congelacion&&(this.datoUsuario.pw_congelar--,t.innerHTML=this.datoUsuario.pw_congelar,r.classList.add("congelado"),o.load(),o.play(),this.congelacion=!0,setTimeout((()=>{r.classList.remove("congelado"),o.pause(),this.congelacion=!1}),2e4))};SFXRespuestaBuena=()=>{const e=new Audio("/build/assets/audio/correcto.mp3");this.hitaudio.pause(),e.play()};SFXRespuestaMala=()=>{const e=new Audio("/build/assets/audio/incorrecto.mp3");this.hitaudio.pause(),e.play()}}const o={template:"mapa-niveles.html",posNivelesMapa:{"nivel-1":{top:"260px",left:"50px"},"nivel-2":{top:"550px",left:"250px"},"nivel-3":{top:"650px",left:"475px"},"nivel-4":{top:"550px",left:"700px"},"nivel-5":{top:"275px",left:"850px"},"nivel-6":{top:"275px",left:"1150px"},"nivel-7":{top:"230px",left:"1400px"},"nivel-8":{top:"150px",left:"1600px"}},juegosPorNiveles:{"nivel-1":{template:"juego1.html",loadLogic:function(){const e=new a;e.setearModal(),e.setearPW(".vidaextra",".congelacion"),e.setearBoton(".pw-vidaextra",(()=>{e.pwVidaExtra(".vida",".vidaextra",".vida-jugador")})),e.setearBoton(".pw-congelacion",(()=>{e.pwCongelacion(".tiempo",".congelacion")})),e.cerrarJuego(3),e.personajeHablar(".personaje","Hola, soy Lucy! trabajo aqui en una tienda de ropa"),e.personajeHablar(".personaje","Necesito ayuda encontrando cuantas variables hay en <br> este problema, si no los encuentro mi jefe <br>me va a despedir!! ayudame porfavor!!",5),e.setearOpciones(".opc",0,(()=>{e.SFXRespuestaMala(),e.personajeHablar(".personaje","No, no es correcto, quizas los tipos de prenda<br> tengan algo que ver",0),e.restarVida(".vida-jugador",".vida")}),(()=>{e.SFXRespuestaBuena(),e.calcularEstrellas(),e.terminarJuego(),e.guardarResultado(1)})),e.inicarJuego(".tiempo-juego",3,(()=>{}))},onDestroy:function(){(new a).cerrarJuego()}},"nivel-2":{template:"juego2.html",loadLogic:function(){const e=new a;e.setearModal(),e.setearPW(".vidaextra",".congelacion"),e.setearBoton(".pw-vidaextra",(()=>{e.pwVidaExtra(".vida",".vidaextra",".vida-jugador")})),e.setearBoton(".pw-congelacion",(()=>{e.pwCongelacion(".tiempo",".congelacion")})),e.cerrarJuego(3),e.personajeHablar(".personaje","Hola, gracias por ayudarme la vez anterior!"),e.personajeHablar(".personaje","El vendedor de fruta local esta teniendo problemas,<br>hay que ayudarlo!!",5),e.personajeHablar(".personaje","Encuentra cuantas restricciones hay!!",10),e.setearOpciones(".opc",2,(()=>{e.SFXRespuestaMala(),e.personajeHablar(".personaje","No, no es correcto, seguro las condiciones del<br>problema tiene algo que ver",0),e.restarVida(".vida-jugador",".vida")}),(()=>{e.SFXRespuestaBuena(),e.calcularEstrellas(),e.terminarJuego(),e.guardarResultado(2)})),e.inicarJuego(".tiempo-juego",3,(()=>{}))},onDestroy:function(){(new a).cerrarJuego()}},"nivel-3":{template:"juego3.html",loadLogic:function(){const e=new a;e.setearModal(),e.setearPW(".vidaextra",".congelacion"),e.setearBoton(".pw-vidaextra",(()=>{e.pwVidaExtra(".vida",".vidaextra",".vida-jugador")})),e.setearBoton(".pw-congelacion",(()=>{e.pwCongelacion(".tiempo",".congelacion")})),e.cerrarJuego(3),e.personajeHablar(".personaje","OH, parece que aqui hay mas problemas!"),e.personajeHablar(".personaje","El jefe de la granja necesita nuestra ayuda <br>necesitamos encontrar las variables",5),e.setearOpciones(".opc",1,(()=>{e.SFXRespuestaMala(),e.personajeHablar(".personaje","No, no es correcto, Es importante especificar,<br> no es lo mismo producto A y B <br>que cantidad de producto A y cantidad de producto B",0),e.restarVida(".vida-jugador",".vida")}),(()=>{e.SFXRespuestaBuena(),e.calcularEstrellas(),e.terminarJuego(),e.guardarResultado(3)})),e.inicarJuego(".tiempo-juego",3,(()=>{}))},onDestroy:function(){(new a).cerrarJuego()}},"nivel-4":{template:"juego4.html",loadLogic:function(){const e=new a;e.setearModal(),e.setearPW(".vidaextra",".congelacion"),e.setearBoton(".pw-vidaextra",(()=>{e.pwVidaExtra(".vida",".vidaextra",".vida-jugador")})),e.setearBoton(".pw-congelacion",(()=>{e.pwCongelacion(".tiempo",".congelacion")})),e.cerrarJuego(3),e.personajeHablar(".personaje","Oh no, es mi jefe de nuevo!"),e.personajeHablar(".personaje","Tengo que encontrar la funcion objetivo!!",5),e.setearOpciones(".opc",1,(()=>{e.SFXRespuestaMala(),e.personajeHablar(".personaje","Jumm, la camisetas se venden a 10$ y los pantalones a 20$",0),e.restarVida(".vida-jugador",".vida")}),(()=>{e.SFXRespuestaBuena(),e.calcularEstrellas(),e.terminarJuego(),e.guardarResultado(4)})),e.inicarJuego(".tiempo-juego",3,(()=>{}))},onDestroy:function(){(new a).cerrarJuego()}},"nivel-5":{template:"juego5.html",loadLogic:function(){const e=new a;e.setearModal(),e.setearPW(".vidaextra",".congelacion"),e.setearBoton(".pw-vidaextra",(()=>{e.pwVidaExtra(".vida",".vidaextra",".vida-jugador")})),e.setearBoton(".pw-congelacion",(()=>{e.pwCongelacion(".tiempo",".congelacion")})),e.cerrarJuego(3),e.personajeHablar(".personaje","Oh no, es mi jefe de nuevo!"),e.personajeHablar(".personaje","Tengo que encontrar las restricciones!!",5),e.setearOpciones(".opc",3,(()=>{e.SFXRespuestaMala(),e.personajeHablar(".personaje","Jumm, lo maximo que podemos vender es 50 y 30",0),e.restarVida(".vida-jugador",".vida")}),(()=>{e.SFXRespuestaBuena(),e.calcularEstrellas(),e.terminarJuego(),e.guardarResultado(5)})),e.inicarJuego(".tiempo-juego",3,(()=>{}))},onDestroy:function(){(new a).cerrarJuego()}},"nivel-6":{template:"juego6.html",loadLogic:function(){const e=new a;e.setearModal(),e.setearPW(".vidaextra",".congelacion"),e.setearBoton(".pw-vidaextra",(()=>{e.pwVidaExtra(".vida",".vidaextra",".vida-jugador")})),e.setearBoton(".pw-congelacion",(()=>{e.pwCongelacion(".tiempo",".congelacion")})),e.cerrarJuego(3),e.personajeHablar(".personaje","perdon por ternerte aqui ayudandome!"),e.personajeHablar(".personaje","Tengo que encontrar la funcion objetiva!!",5),e.setearBoton(".validar",(()=>{o()}));const o=()=>{const a=document.querySelectorAll(".resp"),o=[10,20];let t=0;console.log(a),a.forEach(((e,a)=>{e.value==o[a]?(e.classList.remove("erroneo"),e.classList.add("bueno"),t++):(e.classList.remove("bueno"),e.classList.add("erroneo"))})),2==t?(e.SFXRespuestaBuena(),e.calcularEstrellas(),e.terminarJuego(),e.guardarResultado(6)):(e.SFXRespuestaMala(),e.personajeHablar(".personaje","Cada camiseta se vende por $10 y cada pantalón por $20",0),e.restarVida(".vida-jugador",".vida"))};e.inicarJuego(".tiempo-juego",3,(()=>{}))},onDestroy:function(){(new a).cerrarJuego()}},"nivel-7":{template:"juego7.html",loadLogic:function(){const e=new a;e.setearModal(),e.setearPW(".vidaextra",".congelacion"),e.setearBoton(".pw-vidaextra",(()=>{e.pwVidaExtra(".vida",".vidaextra",".vida-jugador")})),e.setearBoton(".pw-congelacion",(()=>{e.pwCongelacion(".tiempo",".congelacion")})),e.cerrarJuego(3),e.personajeHablar(".personaje","perdon por ternerte aqui ayudandome!"),e.personajeHablar(".personaje","Tengo que encontrar las restricciones!!",5),e.setearBoton(".validar",(()=>{o()}));const o=()=>{const a=document.querySelectorAll(".resp"),o=[45,35];let t=0;console.log(a),a.forEach(((e,a)=>{e.value==o[a]?(e.classList.remove("erroneo"),e.classList.add("bueno"),t++):(e.classList.remove("bueno"),e.classList.add("erroneo"))})),t==a.length?(e.SFXRespuestaBuena(),e.calcularEstrellas(),e.terminarJuego(),e.guardarResultado(7)):(e.SFXRespuestaMala(),e.personajeHablar(".personaje","solo podemos vender 45 camisetas y 35 pantalones",0),e.restarVida(".vida-jugador",".vida"))};e.inicarJuego(".tiempo-juego",3,(()=>{}))},onDestroy:function(){(new a).cerrarJuego()}},"nivel-8":{template:"juego8.html",loadLogic:function(){const e=new a;e.setearModal(),e.setearPW(".vidaextra",".congelacion"),e.setearBoton(".pw-vidaextra",(()=>{e.pwVidaExtra(".vida",".vidaextra",".vida-jugador")})),e.setearBoton(".pw-congelacion",(()=>{e.pwCongelacion(".tiempo",".congelacion")})),e.cerrarJuego(3),e.personajeHablar(".personaje","La panderia necesita nuestra ayuda!"),e.personajeHablar(".personaje","Tenemos que econtrar su funcion objetivo",5),e.setearBoton(".validar",(()=>{o()}));const o=()=>{const a=document.querySelectorAll(".resp"),o=[2,3];let t=0;console.log(a),a.forEach(((e,a)=>{e.value==o[a]?(e.classList.remove("erroneo"),e.classList.add("bueno"),t++):(e.classList.remove("bueno"),e.classList.add("erroneo"))})),t==a.length?(e.SFXRespuestaBuena(),e.calcularEstrellas(),e.terminarJuego(),e.guardarResultado(8)):(e.SFXRespuestaMala(),e.personajeHablar(".personaje","Pan y pasteles que rico, oops perdon",0),e.restarVida(".vida-jugador",".vida"))};e.inicarJuego(".tiempo-juego",3,(()=>{}))},onDestroy:function(){(new a).cerrarJuego()}}},loadLogic:function(){const o=new a,t=JSON.parse(localStorage.getItem("usuario-progreso"));console.log(localStorage.getItem("usuario-progreso"));const r=document.getElementsByClassName("sprite");Array.from(r).map(((a,r)=>{if(console.log(r),t.progreso[r]){a.style.top=this.posNivelesMapa[a.dataset.nivel].top,a.style.left=this.posNivelesMapa[a.dataset.nivel].left,a.firstElementChild.innerText="Nivel "+a.dataset.nivel.split("-")[1],a.classList.remove("hide");const s=t.progreso[r].estrellas;1==s&&(a.lastElementChild.innerText="⭐"),2==s&&(a.lastElementChild.innerText="⭐⭐"),3==s&&(a.lastElementChild.innerText="⭐⭐⭐"),o.setearBoton(a,(()=>{(new e).cargarPantalla(this.juegosPorNiveles[a.dataset.nivel])}))}})),o.setearBoton(".desbloqueables",(()=>{l()})),o.setearBoton(".regresar",(()=>{i()}));const s=()=>{let e=0;return t.progreso.forEach((a=>{e+=a.estrellas})),e},n=()=>{const e=document.querySelector(".pw-vidaExtra"),a=document.querySelector(".pw-congelacion");e.innerHTML=t.pw_vida,a.innerHTML=t.pw_congelar},i=()=>{document.querySelector(".modal").classList.add("hide")},l=()=>{document.querySelector(".modal").classList.remove("hide"),c()},c=()=>{const e=document.querySelectorAll(".desbloqueable-item");e.forEach(((e,a)=>{console.dir(e);const r=e.children[0].innerHTML.slice(1),i=s();console.log(i),i>=r&&e.children[3].classList.contains("hide")&&(o.setearBoton(e.children[3],(()=>{d(e.children[2].innerHTML,a%2),e.children[3].classList.add("hide"),n()})),e.children[3].classList.remove("hide")),t.desbloqueables[a]&&(e.children[2].innerHTML="Reclamado",e.children[3].classList.add("hide"))})),console.log(e)},d=(e,a)=>{console.log(e,a),0==a&&(t.pw_vida=t.pw_vida+parseInt(e),t.desbloqueables.push(1),localStorage.setItem("usuario-progreso",JSON.stringify(t)),c()),1==a&&(t.pw_congelar=t.pw_congelar+parseInt(e),t.desbloqueables.push(1),localStorage.setItem("usuario-progreso",JSON.stringify(t)),c())};n(),(()=>{const e=document.querySelector(".pj-nombre"),a=document.querySelector(".pj-estrellas");e.innerHTML=t.nombre||"Jugador",a.innerHTML=s()})()},onDestroy:function(){}},t={template:"main-menu.html",loadLogic:function(){const t=new a,r={nombre:"PRUEBA1",progreso:[{nivel:1,estrellas:0}],pw_vida:1,pw_congelar:1,desbloqueables:[]};t.setearBoton("#play",(()=>{s()}));const s=()=>{localStorage.getItem("usuario-progreso")&&(new e).cargarPantalla(o),document.querySelector(".modal").classList.remove("hide"),t.setearBoton(".continuar-menu",(()=>{const a=document.querySelector(".nombre").value||"Invitado";document.querySelector(".modal").classList.add("hide"),r.nombre=a,localStorage.setItem("usuario-progreso",JSON.stringify(r)),(new e).cargarPantalla(o)}))}},onDestroy:function(){}};(new e).cargarPantalla(t)})();